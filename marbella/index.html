<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de canciones y complacencias</title>
    <style>
            .error-message {
              display: none;
            }
            .error-message .close {
                position: absolute;
                top: 10px;
                right: 15px;
                padding: 5px 10px;
                background-color: #dc3545;
                color:white;
                border: none;
                cursor: pointer;
                }

            .error-message .close:hover {
            background-color: #ddd;
            }
          </style>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        class Cancion {
            constructor(artista, cancion, karaoke, canta) {
                this.artista = artista;
                this.cancion = cancion;
                this.karaoke = karaoke;
                this.canta = canta;
            }
        }

        function deleteRow(input, row) {
            console.log("deleting row")
            console.log(input)
            axios.delete('http://localhost:8080/' + input)
            .then(response => {
            console.log('Canción eliminada exitosamente:', response.data);
            row.remove();
            })
            .catch(error => {
            console.error('Error al eliminar la canción:', error);
            });

        }

        function insertSongRow(karaoke, tableBody) {
            const row = tableBody.append('<tr></tr>').children().last(); 
                row.append('<td class="song-id">' + karaoke.id + '</td>');
                row.append('<td>' + karaoke.canta + '</td>');
                row.append('<td>' + karaoke.artista + '</td>');
                row.append('<td>' + karaoke.cancion + '</td>');

                const actionCell = row.append('<td></td>').children().last();
                const deleteButton = $('<button class="btn btn-sm btn-danger deleteButton">Eliminar</button>');
                deleteButton.data('id', karaoke.id); 
                deleteButton.click(function() {
                    deleteRow(karaoke.id, row)
                });
                actionCell.append(deleteButton);
        }

     $(document).ready(function() {
        $("#formulario-complacencias").submit(function(event) {
            event.preventDefault(); 
             // Validar que los inputs no estén vacíos
             if (cancion === "") {
                alert("Por favor ingresa el nombre de la cancion ");
                return;
            }
            const tableBody = $('#tabla-canciones').find('tbody');
            var karaokeProvider = "Marbella"
            // Obtener valores de los inputs
            var nombreCantante = $("#cantante").val() || karaokeProvider;
            var artista = $("#artista").val();
            var cancion = $("#cancion").val();
            var karaoke = this.karaokeProvider
            const cancion1 = new Cancion(artista, cancion, karaoke, nombreCantante);
            axios.post('http://localhost:8080/', {
                artista: cancion1.artista,
                cancion: cancion1.cancion,
                karaoke: cancion1.karaoke,
                nombreCantante: cancion1.nombreCantante
            })
            .then(response => {
                insertSongRow(response.data, tableBody)
            })
            .catch(error => {
                console.error('Error al enviar la canción:', error);
                const errorMessageDiv = $('.error-message');
                 errorMessageDiv.append('<p class="error-message__content"><strong>Error:</strong> ' + error.response.data + '</p>');
                 errorMessageDiv.show();
            });
        });

        // quien canta 
        $("#whoSings").change(function() {
            if ($(this).val() === "yo") {
                $("#cantante").prop("disabled", false);
            } else {
                $("#cantante").prop("disabled", true);
            }
        });

        // llamada lista canciones
         $("#getAllButton").click(function() {
             axios.get('http://localhost:8080/all', {
            })
            .then(response => {
                const tableBody = $('#tabla-canciones').find('tbody');
                tableBody.empty(); 
                response.data.forEach(function(karaoke) { 
                    insertSongRow(karaoke, tableBody)
               });
            })
            .catch(error => {
                console.error(error);
            });
        });


        // cierra mensaje de error 
        $('.error-message .close').on('click', function() {
            $(this).siblings('.error-message__content').empty(); 
            $(this).parent('.error-message').hide();
        });
    });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
</head>
<body>
    <div class="container mt-3"> <h1>Lista de canciones</h1>

        <table id="tabla-canciones" class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>id</th>
                    <th>Canta</th>
                    <th>Artista</th>
                    <th>Canción</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td>Marbella</td>
                    <td>Vicente Fernandez</td>
                    <td>Matalas</td>
                    <td><button class="btn btn-sm btn-danger deleteButton">Eliminar</button></td>
                </tr>
                </tbody>
        </table>

        <div class="alert alert-danger alert-dismissible error-message"> 
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">&times;</button>
        </div>

        <hr class="my-4"> <h2>Complacencias</h2>

        <form id="formulario-complacencias" class="row"> <div class="col-md-6"> <label for="whoSings" class="form-label">¿Quieres cantar?</label>
                <select class="form-select" id="whoSings" name="singer">
                    <option value="you">No, quiero que cante la artista</option>
                    <option value="yo">Sí, quiero cantar</option>
                </select>
            </div>

            <div class="col-md-6"> <label for="cantante" class="form-label">Tu nombre</label>
                <input type="text" class="form-control" disabled id="cantante" name="cantante" placeholder="Ingresa tu nombre">
            </div>

            <div class="col-md-6"> <label for="artista" class="form-label">Artista:</label>
                <input type="text" class="form-control" id="artista" name="artista" placeholder="Ingresa el nombre del artista">
            </div>

            <div class="col-md-6"> <label for="cancion" class="form-label">Canción:</label>
                <input type="text" class="form-control" id="cancion" name="cancion" placeholder="Ingresa el título de la canción">
            </div>

            <div class="col-12 mt-3"> <button type="submit"  id="createButton" class="btn btn-primary">Enviar</button>
            </div>
        </form>
        <button  id="getAllButton" class="btn btn-sm btn-danger deleteButton">Actualizar</button>
    </div>

   
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
</body>


</html>